import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CollapsibleApiParam from '@site/src/components/CollapsibleApiParam';
import CollapsibleNestedParams from '@site/src/components/CollapsibleNestedParams';
import ApiParam from '@site/src/components/ApiParam';

<div className="main-container-endpoint">
    <div className="container-endpoint">
            <div className="container-method-patch">
                <span className="endpoint-method">PATCH</span>
            </div>
              <div className="container-url">
                <span className="endpoint-url">/ver1/bots/:bot_id/update</span>
           </div>
    </div>
    <div className="container-permission">
        <span className="permission-description"><strong>Permission: </strong>BOTS_WRITE</span>
        <span className="permission-description"><strong>Security: </strong>SIGNED</span>
    </div>
</div>

<p class="p-method-discription"> Edits an existing DCA Bot using its ID</p>


<h2> Path Parameter</h2>
 
<ApiParam name='bot_id' type='integer' id="bot_id" required>
  Unique 3Commas ID for this DCA Bot entity
</ApiParam>


<h2> Body Parameters</h2>

<ApiParam name='name' type='string' id="name" required>
  DCA Bot name specified by the user
</ApiParam>

<ApiParam name='pairs' type='string' id="pairs" required>
  Trading pair(s) in 3Commas format
</ApiParam>

<ApiParam name='take_profit' type='number' id="take_profit" required>
  <p>
    Percentage value for the botâ€™s Take Profit. 
  </p>
  <p>
    If multiple steps are specified in <code>take_profit_steps settings</code>, this parameter should be set to <code>0</code>
  </p>
</ApiParam>



<h3> More attributes </h3>

 <CollapsibleApiParam name='max_active_deals' type='boolean' id="max_active_deals">
    <div> The maximum number of active deals available for this DCA Bot. Minimum:<code>1</code>, Maximum:<code>199</code> </div>
    <div> Default: <code>1</code></div>
  </CollapsibleApiParam>

<CollapsibleApiParam name='base_order_volume_type' type='number' id="base_order_volume_type">
    The volume type of the base order for this DCA Bot: <code>quote_currency</code>, <code>base_currency</code> or <code>percent</code>
  </CollapsibleApiParam>

<CollapsibleApiParam name='base_order_volume' type='number' id="base_order_volume" required>
    The volume of the base order for this DCA Bot
  </CollapsibleApiParam>

<CollapsibleApiParam name='take_profit_steps' type='array[object]' id="take_profit_steps">
    Take Profit Steps, each represented as an object with properties:
    <ul>
      <li>amount_percentage</li>
      <li>profit_percentage</li>
  </ul>
  </CollapsibleApiParam> 

<CollapsibleApiParam name='safety_order_volume' type='number' id="safety_order_volume" required>
    The volume of the Safety Order for this DCA Bot
  </CollapsibleApiParam>

<CollapsibleApiParam name='safety_order_volume_type' type='string' id="safety_order_volume_type">
    The volume type of the Safety Order for this DCA Bot
  </CollapsibleApiParam>

<CollapsibleApiParam name='martingale_volume_coefficient' type='number' id="martingale_volume_coefficient" required>
    <div> Coefficient for increasing safety order volume in Martingale strategy</div>
    <div> Minimum:<code>0,1</code>; Maximum:<code>10</code> </div>
  </CollapsibleApiParam>

<CollapsibleApiParam name='martingale_step_coefficient' type='number' id="martingale_step_coefficient" required>
    <div> Coefficient for increasing safety order price (<code>safety_order_step_percentage</code>) in Martingale strategy</div>
    <div> Minimum:<code>0,1</code>; Maximum:<code>10</code> </div>
  </CollapsibleApiParam>

<CollapsibleApiParam name='max_safety_orders' type='integer' id="max_safety_orders" required>
    <div> The maximum total number of Safety Orders allowed per deal opened by this DCA Bot </div>
    <div> Minimum:<code>0</code>; Maximum:<code>200</code> </div>
  </CollapsibleApiParam>

<CollapsibleApiParam name='active_safety_orders_count' type='integer' id="active_safety_orders_count" required>
    The number of active Safety Orders the DCA Bot is allowed to place at one time
  </CollapsibleApiParam>

<CollapsibleApiParam name='stop_loss_percentage' type='number' id="stop_loss_percentage">
  <p>
    The percentage of price movement in the opposite direction of the Take Profit target that triggers the Stop Loss. The value should be set to <code>0</code> to disable Stop Loss
  </p>  
</CollapsibleApiParam>

<CollapsibleApiParam name="sl_to_breakeven_enabled" type="boolean" id="sl_to_breakeven_enabled">
  <p>
    Enables (<code>true</code>) or disables (<code>false</code>) the Move to Breakeven feature for this DCA Bot. 
    To use this feature, you must have at least two Take Profit steps
  </p>
  <p>
    <strong>Default: </strong> <code>false</code>
  </p>
</CollapsibleApiParam>

<CollapsibleApiParam name="sl_to_breakeven_data" type="json" id="sl_to_breakeven_data">
  <p>
    Upper limit for Stop Loss to move to breakeven, where <code>0</code> is the base order bought price, 
    <code>1</code> is the 1st step of TP, and <code>2</code> is the 2nd step of TP
  </p>
  <div>
    <strong>Example:</strong>
    <pre>
      <code>
{`{
  "example_key": "example_value"
}`}
      </code>
    </pre>
  </div>
</CollapsibleApiParam>

<CollapsibleApiParam name='cooldown' type='number' id="cooldown">
  <p>
    The time (in seconds) that the DCA bot will wait after closing a deal before accepting a signal to start a new deal for the same asset pair 
    </p>
  <p>
    <strong> Minimum: </strong> <code>0</code>; <strong>Maximum: </strong> <code>2592000</code>
  </p>
</CollapsibleApiParam>

<CollapsibleApiParam name='trailing_enabled' type='boolean' id="trailing_enabled">
  Indicates whether trailing is enabled for Take Profit (<code>true</code>) or not (<code>false</code>)
</CollapsibleApiParam>

<CollapsibleApiParam name='trailing_deviation' type='number' id="trailing_deviation" required>
  <p>
    Percentage value of the trailing price, in percent
    </p>
  <p>
    This parameter is required when <code>trailing_enabled</code> is set to <code>true</code> 
     </p>
</CollapsibleApiParam>

<CollapsibleApiParam name='safety_order_step_percentage' type='number' id="safety_order_step_percentage" required>
  Price deviation in percentage to open Safety Trades
</CollapsibleApiParam>

<CollapsibleApiParam name='take_profit_type' type='string' id="take_profit_type" required>
  The type of profit (<code>base</code> or <code>total</code>), which sets the basis for profit calculation in this DCA Bot.
</CollapsibleApiParam>

<CollapsibleApiParam name='strategy_list' type='array[json]' id="strategy_list" required>
  Array of strategies specifically for opening deals in this DCA Bot
</CollapsibleApiParam>

<CollapsibleApiParam name='leverage_type' type='string' id="leverage_type">
  Sets leverage settings for a futures account: <code>cross</code> or <code>isolated</code>
</CollapsibleApiParam>

<CollapsibleApiParam name='leverage_custom_value' type='number' id="leverage_custom_value">
  Leverage value. Leverage value is dependent on the exchange and the pair
</CollapsibleApiParam>

<CollapsibleApiParam name='stop_loss_timeout_enabled' type='boolean' id="stop_loss_timeout_enabled">
  <p>
    Indicates whether the Stop Loss timeout is enabled (<code>true</code>) or disabled (<code>false</code>)
    </p>
  <p>
  <strong>Default: </strong> <code>false</code>
    </p>
  </CollapsibleApiParam>

<CollapsibleApiParam name='stop_loss_timeout_in_seconds' type='integer' id="stop_loss_timeout_in_seconds">
  <p>  
    Value timeout in seconds. This parameter is required when <code>stop_loss_timeout_enabled</code> is set to <code>true</code>
  </p>  
</CollapsibleApiParam>

<CollapsibleApiParam name='tsl_enabled' type='boolean' id="tsl_enabled">
  Indicates whether trailing is enabled (<code>true</code>) for Stop Loss or not (<code>false</code>)
</CollapsibleApiParam>

<CollapsibleApiParam name='min_volume_btc_24h' type='number' id="min_volume_btc_24h">
  The minimum trading volume in BTC over the last 24 hours required to open a deal
</CollapsibleApiParam>

<CollapsibleApiParam name='deal_start_delay_seconds' type='integer' id="deal_start_delay_seconds">
  Delay in seconds before a new deal starts
</CollapsibleApiParam>

<CollapsibleApiParam name='profit_currency' type='string' id="profit_currency">
  Currency used for the profit from the trades executed by this bot: <code>base_currency</code>; <code>quote_currency</code>
</CollapsibleApiParam>

<CollapsibleApiParam name='start_order_type' type='string' id="start_order_type">
  The start order type for this DCA Bot: <code>limit</code> or <code>market</code>
</CollapsibleApiParam>

<CollapsibleApiParam name='stop_loss_type' type='string' id="stop_loss_type">
  The type of action the bot should perform after closing a deal due to the Stop Loss setting: <code>stop_loss</code> or <code>stop_loss_and_disable_bot</code>
</CollapsibleApiParam>

<CollapsibleApiParam name='disable_after_deals_count' type='integer' id="disable_after_deals_count">
  The number of opening deals after which the DCA Bot will be disabled
</CollapsibleApiParam>

<CollapsibleApiParam name='allowed_deals_on_same_pair' type='integer' id="allowed_deals_on_same_pair">
  <p>
    Allows setting up a specific number of deals on the same pair. 
   </p>
  <p>
    It works only for bots where <code>type</code> is <code>Bot::MultiBot</code>
  </p>
</CollapsibleApiParam>

<CollapsibleApiParam name='min_profit_percentage' type='number' id="min_profit_percentage">
  The minimum profit percentage. When it is reached, the deal will be completed by the chosen strategy
</CollapsibleApiParam>

<CollapsibleApiParam name='min_profit_type' type='string' id="min_profit_type">
  The type of minimum profit, which sets the basis for profit calculation in this DCA Bot: <code>base_order_volume</code> or <code>total_bought_volume</code>
</CollapsibleApiParam>
  
<CollapsibleApiParam name='close_strategy_list' type='array[json]' id="close_strategy_list">
  Array of strategies used for closing deals in this DCA Bot
</CollapsibleApiParam>

<CollapsibleApiParam name='risk_reduction_percentage' type='number' id="risk_reduction_percentage">
  Percentage of losses that allows reducing the base order and Safety Orders proportionally to losses
</CollapsibleApiParam>

<CollapsibleApiParam name='reinvesting_percentage' type='number' id="reinvesting_percentage">
  <p>
    Set up a percentage of realized profit to be reinvested in each new deal
    </p>
  <p>
  <strong>Minimum: </strong> <code>0</code>; <strong>Maximum: </strong><code>100</code>
  </p>
</CollapsibleApiParam>

<CollapsibleApiParam name='min_price_percentage' type='number' id="min_price_percentage">
  Min price percent. Must be greater than <code>-95</code> and lower than <code>1000</code>
</CollapsibleApiParam>

<CollapsibleApiParam name='max_price_percentage' type='number' id="max_price_percentage">
  Max price percent. Must be greater than <code>-95</code> and lower than <code>1000</code>
</CollapsibleApiParam>

<CollapsibleApiParam name='close_deals_timeout' type='integer' id="close_deals_timeout">
  <p>
    The time in seconds after which the deals will close automatically
    </p>
  <p>
    <strong>Minimum: </strong> <code>60</code>
  </p>
</CollapsibleApiParam> 

<h3>
  Additional Information
</h3>

<div style={{ margin: '20px', padding: '10px', borderBottom: '1px solid rgba(53, 58, 68, 0.4)', }}>
  <p>
    <strong>pairs</strong>
  </p>
  <p>
    Use endpoint [All market pairs](/docs/Market%20data/All%20market%20pairs.md) to get value for parameter.
  </p>
</div>

<div style={{ margin: '20px', padding: '10px', borderBottom: '1px solid rgba(53, 58, 68, 0.4)', }}>
  <p> 
    <strong>leverage_custom_value</strong>
  </p>
  <p>
     Use endpoints [Currency rates and limits with leverage data](/docs/Market%20data/Currency%20rates%20and%20limits%20with%20leverage%20data.md) to check available value for this parameter.
  </p>
</div>

<div style={{ margin: '20px', padding: '10px', borderBottom: '1px solid rgba(53, 58, 68, 0.4)', }}>
  <p>
    <strong>take_profit_steps</strong>
  </p>
  <p>
    When using multiple steps for Take Profit, each step should be represented as an object with the following properties:
  </p>
  <ul>
      <li><code>amount_percentage</code></li>
      <li><code>profit_percentage</code></li>
  </ul>
  <p>
      Keep in mind, you can create a maximum of 4 targets, allocating 100% of your position volume is allocated across them
  </p>
  <div>
    <strong>For example:</strong>
      <pre>
        <code className="language-json">
          {`
        {
          "take_profit_steps": [
          {
           "amount_percentage": 50,
           "profit_percentage": 10
          },
         {
           "amount_percentage": 50,
           "profit_percentage": 20
         }
        ] 
        }
        `}
        </code>
      </pre>
  </div>
</div>

<div style={{ margin: '20px', padding: '10px', }}>
  <p>
    <strong>strategy_list, close_strategy_list, safety_strategy_list</strong>
  </p>
  <p>
    The data strategies are used to populate the <code>strategy_list</code> and <code>close_strategy_list</code> parameters. 
    You can retrieve the full list of strategies available for this DCA bot through the <a href="DCA%20Bot/Available%20strategy%20list%20for%20bot.md" target="_blank"> Available strategy list for bot </a> endpoint.
  </p>
  <p>
    Below are several examples demonstrating how to fill these parameters with strategy data:
  </p>
  <div style={{ margin: '0px', padding: '10px' }}> 
  <Tabs>
     <TabItem value="manual_signals" label="Manual signals" default>
      ```json
      [
      {
      "strategy": "manual"
      }
      ]
      ```
      or
      ```
      []
      ```
     </TabItem>
    <TabItem value="non_stop" label="Non-stop">
      It's using only for 1 pair bot.
      ```json
      [
      {
      "strategy": "nonstop"
      },
      {
      "options": {}
      }
      ]
      ```
   </TabItem>
   <TabItem value="qfl" label="QFL">
      ```json
      [
      {
      "options": {
      "type": "original",
      "percent": 3
      },
      "strategy": "qfl"
      }
      ]
      ```
   </TabItem>
   <TabItem value="tradingview" label="TradingView">
      ```json
      [
      {
      "options": {
      "time": "5m",
      "type": "buy_or_strong_buy"
      },
      "strategy": "trading_view"
      }
      ]
      ```
   </TabItem>
   <TabItem value="rsi" label="RSI">
      ```json
      [
      {
      "options": {
      "time": "5m",
      "points": 30,
      "trigger_condition": "less",
      "time_period": 7
      },
      "strategy": "rsi"
      }
      ]
      ```
   </TabItem>
  </Tabs>
</div>
</div>

<h2> 
  Parameters response 
</h2>

<p className="custom-class-p">
  If successful, the response includes a copy of [DCA Bot](./README.md) entity.
</p>


<h2>
  Example Request
</h2>

<div style={{ margin: '20px', padding: '10px' }}>
```json title="PATCH /ver1/bots/12345678/update"
{
   "account_id": 32199203,
   "name": "name DCA Bot",
   "pairs": "USDT_ETH",
   "strategy_list": [
      {
         "options": {},
         "strategy": "nonstop"
      }
   ],
   "base_order_volume": "100.0",
   "take_profit_type": "total",
   "take_profit": null,
   "take_profit_steps": [
    {
        "amount_percentage": 50,
        "profit_percentage": 10
        },
    {
        "amount_percentage": 50,
        "profit_percentage": 20
    }
],
   "stop_loss_percentage": "8",
   "close_deals_timeout": "100",
   "max_safety_orders": 3,
   "active_safety_orders_count": 3,
   "safety_order_volume": "20.0",
   "safety_order_step_percentage": "1.0",
   "min_profit_type": null,
   "martingale_volume_coefficient": "2",
   "martingale_step_coefficient": "2"
}
```
</div>

<h2>
   Example response and errors
</h2>

<div style={{ margin: '20px', padding: '10px' }}>
  <Tabs>
    <TabItem value="200" label="200 OK" attributes={{className: "green"}}>
  ```json
{
    "id": 15656489,
    "account_id": 32199203,
    "is_enabled": false,
    "max_safety_orders": 3,
    "active_safety_orders_count": 3,
    "pairs": [
        "USDT_ETH"
    ],
    "strategy_list": [
        {
            "options": {},
            "strategy": "nonstop"
        }
    ],
    "close_strategy_list": [],
    "safety_strategy_list": [],
    "max_active_deals": 1,
    "active_deals_count": 0,
    "deletable?": true,
    "created_at": "2024-11-19T21:04:11.299Z",
    "updated_at": "2024-11-21T15:22:24.557Z",
    "trailing_enabled": null,
    "tsl_enabled": false,
    "deal_start_delay_seconds": null,
    "stop_loss_timeout_enabled": false,
    "stop_loss_timeout_in_seconds": 0,
    "disable_after_deals_count": null,
    "deals_counter": null,
    "allowed_deals_on_same_pair": null,
    "easy_form_supported": false,
    "close_deals_timeout": 100,
    "url_secret": "5e334993e6",
    "take_profit_steps": [
        {
            "amount_percentage": 50,
            "profit_percentage": 10,
            "id": 0
        },
        {
            "amount_percentage": 50,
            "profit_percentage": 20,
            "id": 1
        }
    ],
    "name": "name DCA Bot",
    "take_profit": null,
    "min_profit_percentage": null,
    "base_order_volume": "100.0",
    "safety_order_volume": "20.0",
    "safety_order_step_percentage": "1.0",
    "take_profit_type": "total",
    "min_profit_type": null,
    "type": "Bot::SingleBot",
    "martingale_volume_coefficient": "2.0",
    "martingale_step_coefficient": "2.0",
    "stop_loss_percentage": "8.0",
    "cooldown": "0",
    "btc_price_limit": "0.0",
    "strategy": "long",
    "min_volume_btc_24h": "0.0",
    "profit_currency": "quote_currency",
    "min_price": null,
    "max_price": null,
    "stop_loss_type": "stop_loss",
    "safety_order_volume_type": "quote_currency",
    "base_order_volume_type": "quote_currency",
    "account_name": "Paper Account 1251857",
    "trailing_deviation": "0.2",
    "finished_deals_profit_usd": "0.0",
    "finished_deals_count": "0",
    "leverage_type": "not_specified",
    "leverage_custom_value": null,
    "start_order_type": "limit",
    "active_deals_usd_profit": "0.0",
    "reinvesting_percentage": null,
    "risk_reduction_percentage": null,
    "reinvested_volume_usd": null,
    "min_price_percentage": null,
    "max_price_percentage": null
```
  </TabItem>
  <TabItem value="400" label="400 Bad Request" attributes={{className: "red"}}>
    ```json
{
    "error": "record_invalid",
    "error_description": "Invalid parameters",
    "error_attributes": {
        "stop_loss_percentage": [
            "Stop Loss should be below the last safety order (7.0)"
        ]
    }
}
```
  </TabItem>
</Tabs>
</div>
